"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r=require("@react-three/fiber"),t=require("react");function n(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var o=n(e),s=n(t);const a=e=>{if(Array.isArray(e))return e[0];if("object"==typeof e&&null!==e){return e[Object.keys(e)[0]][0]}return{w:0,h:0}},u=(e,r,t,n)=>{const s=r*(n.aspect>e/r?n.width/e:n.height/r),a=e*(n.aspect>e/r?n.width/e:n.height/r)*t,u=s*t;let c=Math.min(1,a),i=Math.min(1,u);return a>1&&(c=1,i=u/a*1),new o.Vector3(c,i,1)};function c(n,c,i,f,l){const h=r.useThree((e=>e.viewport)),m=s.useRef(null),p=s.useRef(0),[d,w]=t.useState(null),[y,g]=s.useState(new o.Texture),x=new o.TextureLoader,[S,b]=t.useState(null);function L(e){(e||n)&&new Promise((r=>{x.load(null!=e?e:n,r)})).then((e=>{O(null,e)}))}function j(e,r,t){const n=fetch(e).then((e=>e.json())),o=new Promise((e=>{x.load(r,e)}));Promise.all([n,o]).then((e=>{t(e[0],e[1])}))}s.useLayoutEffect((()=>(c&&n?j(c,n,O):n&&L(),()=>{n&&r.useLoader.clear(e.TextureLoader,n)})),[]);const O=(e,r)=>{let t=new o.Vector3(1,1,1);if(null===e){if(r&&f){const e=r.image.width,n=r.image.height,o=e/f,s=n;if(p.current=f,m.current={frames:[],meta:{version:"1.0",size:{w:e,h:n},scale:"1"}},parseInt(o.toString(),10)===o)for(let e=0;e<f;e++)m.current.frames.push({frame:{x:e*o,y:0,w:o,h:s},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:o,h:s},sourceSize:{w:o,h:n}});t=u(o,s,.1,h)}}else if(r){m.current=e,m.current.frames=z(),p.current=Array.isArray(e.frames)?e.frames.length:Object.keys(e.frames).length;const{w:r,h:n}=a(e.frames).sourceSize;t=u(r,n,.1,h)}w(m.current),"encoding"in r?r.encoding=3001:r.colorSpace="srgb",g(r),b({spriteTexture:r,spriteData:m.current,aspect:t})},z=()=>{const e={},r=m.current,t=i;if(t&&Array.isArray(r.frames)){for(let n=0;n<t.length;n++){e[t[n]]=[];for(const o of r.frames){const r=o.frame,s=r.x,a=r.y,u=r.w,c=r.h,i=o.sourceSize.w,f=o.sourceSize.h;"string"==typeof o.filename&&-1!==o.filename.toLowerCase().indexOf(t[n].toLowerCase())&&e[t[n]].push({x:s,y:a,w:u,h:c,frame:r,sourceSize:{w:i,h:f}})}}return e}if(t&&"object"==typeof r.frames){for(let n=0;n<t.length;n++){e[t[n]]=[];for(const o in r.frames){const s=r.frames[o],a=s.frame,u=a.x,c=a.y,i=a.w,f=a.h,l=s.sourceSize.w,h=s.sourceSize.h;"string"==typeof o&&-1!==o.toLowerCase().indexOf(t[n].toLowerCase())&&e[t[n]].push({x:u,y:c,w:i,h:f,frame:a,sourceSize:{w:l,h:h}})}}return e}{const e=[];for(const t in r.frames)e.push(r.frames[t]);return e}};return s.useLayoutEffect((()=>{null==l||l(y,d)}),[y,d]),{spriteObj:S,loadJsonAndTexture:function(e,r){r&&e?j(r,e,O):L(e)}}}c.preload=t=>r.useLoader.preload(e.TextureLoader,t),c.clear=t=>r.useLoader.clear(e.TextureLoader,t),exports.calculateAspectRatio=u,exports.getFirstItem=a,exports.useSpriteLoader=c;
